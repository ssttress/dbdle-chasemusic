<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>DBD Chase Music Guessing Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
      background-color: #121212;
      background-image: url('background.png');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      color: #f0f0f0;
      position: relative;
      min-height: 100vh;
      box-sizing: border-box;
      padding-bottom: 0;
      margin: 0;
      height: 100vh;
    }

    input,
    button {
      padding: 10px;
      margin: 5px;
      font-size: 18px;
    }

    #guessInput {
      text-transform: capitalize;
    }

    #guesses {
      margin-top: 20px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      max-height: 270px;
      overflow-y: auto;
      padding-bottom: 20px;
      padding-right: 10px;
      box-sizing: border-box;
    }

    .guess-row {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      font-weight: bold;
    }

    .wrong {
      background-color: #802020;
    }

    .correct {
      background-color: #207020;
    }

    #winMessage {
      font-size: 24px;
      margin-top: 20px;
      color: limegreen;
    }

    #loseMessage {
      font-size: 24px;
      margin-top: 20px;
      color: red;
    }

    #newRoundButton {
      display: none;
      margin-top: 10px;
    }

    .audio-btn {
      font-size: 18px;
      padding: 10px 16px;
      border-radius: 6px;
      background-color: #303030;
      color: white;
      cursor: pointer;
      min-width: 80px;
    }

    .audio-btn:hover {
      background-color: #505050;
    }

    .dropdown {
      position: absolute;
      background-color: #222;
      border: 1px solid #444;
      border-radius: 4px;
      z-index: 10;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      display: none;
    }

    .dropdown .highlighted {
      background-color: #555;
    }

    .dropdown div {
      padding: 8px;
      cursor: pointer;
    }

    .dropdown div:hover {
      background-color: #444;
    }

    #audioButtons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    #audioVolumeContainer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 0px;
      margin-left: -30px;
    }

    #volumeSlider {
      -webkit-appearance: slider-vertical;
      writing-mode: bt-lr;
      width: 30px;
      height: 70px;
      cursor: pointer;
      background: transparent;
      margin: 0;
      padding: 0;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    #volumeSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 20px;
      width: 30px;
      background: #ccc;
      border-radius: 4px;
      cursor: pointer;
      margin-top: -7px;
    }

    #volumeSlider::-moz-range-thumb {
      height: 20px;
      width: 30px;
      background: #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

    #giveUpButton {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background-color: #802020;
      color: white;
      border: none;
      padding: 10px 16px;
      font-size: 18px;
      border-radius: 6px;
      cursor: pointer;
      margin: 0;
    }

    #giveUpButton:hover {
      background-color: #a03030;
    }

    #shared-note {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 90vw;
      font-size: 14px;
      color: #ccc;
      margin: 0;
      padding: 6px 12px;
      background-color: rgba(30, 30, 30, 0.9);
      border-radius: 6px;
      z-index: 999;
      user-select: none;
    }

    #gameLogo {
      max-width: 500px;
      height: auto;
      margin-bottom: 0px;
    }
  </style>
</head>

<body>

  <img src="logo.png" alt="Game Logo" id="gameLogo" />

  <h1>Guess the Killer's Chase Music</h1>

  <div id="audioVolumeContainer">
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" aria-label="Volume slider" />

    <div id="audioButtons">
      <button class="audio-btn" data-tier="0">32m ▶</button>
      <button class="audio-btn" data-tier="1">16m 🔒</button>
      <button class="audio-btn" data-tier="2">8m 🔒</button>
      <button class="audio-btn" data-tier="3">Chase 🔒</button>
    </div>
  </div>

  <audio id="audioPlayer" hidden></audio>

  <div style="position: relative; display: inline-block;">
    <input type="text" id="guessInput" placeholder="Enter killer name" autocomplete="off" />
    <div id="suggestions" class="dropdown"></div>
  </div>

  <p id="shared-note">
    Note: Trapper, Wraith, Pig, Plague, Freddy, Bubba and Huntress share the same
    default chase music. Your guess will autocorrect to "Default" for them.
  </p>

  <button id="submitGuess">Submit Guess</button>

  <div id="guesses"></div>
  <div id="winMessage"></div>
  <div id="loseMessage"></div>
  <button id="newRoundButton">Play New Round</button>

  <button id="giveUpButton">Give Up</button>

  <script>
    const aliases = {
      "bubba": "Default",
      "cannibal": "Default",
      "myers": "Shape",
      "pyramid head": "Executioner",
      "pinhead": "Cenobite",
      "wesker": "Mastermind",
      "alien": "Xenomorph",
      "chucky": "Good Guy",
      "vecna": "Lich",
      "dracula": "Dark Lord",
      "kaneki": "Ghoul",
      "springtrap": "Animatronic",
      "trapper": "Default",
      "wraith": "Default",
      "pig": "Default",
      "plague": "Default",
      "freddy": "Default",
      "huntress": "Default"
    };

    const killerNames = [
      "Default", "Hillbilly", "Nurse", "Shape", "Hag", "Doctor", "Clown",
      "Spirit", "Legion", "Ghost_Face", "Demogorgon", "Oni", "Deathslinger",
      "Executioner", "Blight", "Twins", "Trickster", "Nemesis", "Cenobite",
      "Artist", "Onryo", "Dredge", "Mastermind", "Knight", "Skull_Merchant",
      "Singularity", "Xenomorph", "Good_Guy", "Unknown", "Lich", "Dark_Lord",
      "Houndmaster", "Ghoul", "Animatronic"
    ];

    const tierLabels = ["32m", "16m", "8m", "chase"];

    const killers = killerNames.map(name => ({
      name: name.replace(/_/g, " "),
      files: tierLabels.reduce((files, tier, index) => {
        files[tier] = `TerrorRadius_${name}_${String(index).padStart(3, '0')}.ogg`;
        return files;
      }, {})
    }));

    console.log(killers);

    let currentKiller = null;
    let gameWon = false;
    let unlockedTier = 0;
    let currentAudio = new Audio();
    let playingTier = null;
    let previousGuesses = new Set();

    const guessesContainer = document.getElementById("guesses");
    const winMessage = document.getElementById("winMessage");
    const loseMessage = document.getElementById("loseMessage");
    const newRoundButton = document.getElementById("newRoundButton");
    const guessInput = document.getElementById("guessInput");
    const suggestions = document.getElementById("suggestions");

    const buttons = Array.from(document.querySelectorAll(".audio-btn"));

    function resetAudioButtons() {
      buttons.forEach((btn, i) => {
        const label = tierLabels[i];
        btn.textContent = `${label} ${i <= unlockedTier ? '▶' : '🔒'}`;
      });
    }

    function startNewGame() {
      currentKiller = killers[Math.floor(Math.random() * killers.length)];
      gameWon = false;
      unlockedTier = 0;
      playingTier = null;
      previousGuesses.clear();
      winMessage.textContent = '';
      loseMessage.textContent = '';
      guessesContainer.innerHTML = '';
      guessInput.value = '';
      newRoundButton.style.display = 'none';
      document.getElementById("giveUpButton").style.display = 'inline-block';
      if (currentAudio) currentAudio.pause();
      resetAudioButtons();
    }

    buttons.forEach((button, index) => {
      button.addEventListener("click", () => {
        if (index > unlockedTier || !currentKiller) return;

        const label = tierLabels[index];
        const file = currentKiller.files[label];

        if (playingTier === index) {
          currentAudio.pause();
          button.textContent = `${label} ▶`;
          playingTier = null;
        } else {
          if (playingTier !== null && currentAudio) {
            buttons[playingTier].textContent = tierLabels[playingTier] + ' ▶';
            currentAudio.pause();
          }

          if (!currentAudio || playingTier === null) {
            currentAudio = new Audio(`sounds/${file}`);
            currentAudio.play();
            playingTier = index;
          } else if (playingTier !== index) {
            currentAudio = new Audio(`sounds/${file}`);
            currentAudio.play();
            playingTier = index;
          } else {
            currentAudio.play();
            playingTier = index;
          }

          resetAudioButtons();
          button.textContent = `${label} ⏸`;

          currentAudio.addEventListener("ended", () => {
            button.textContent = `${label} ▶`;
            playingTier = null;
          });
        }
      });
    });

    const volumeSlider = document.getElementById('volumeSlider');

    volumeSlider.addEventListener('input', () => {
      if (currentAudio) {
        currentAudio.volume = volumeSlider.value;
      }
    });

    document.getElementById("submitGuess").addEventListener("click", () => {
      const userGuess = guessInput.value.trim();
      const guessLower = userGuess.toLowerCase();
      const normalizedGuess = aliases[guessLower] || userGuess;
      const normalizedLower = normalizedGuess.toLowerCase();

      suggestions.style.display = 'none';

      if (!currentKiller || gameWon || !userGuess) return;

      if (previousGuesses.has(normalizedLower)) {
        alert("You've already guessed that!");
        return;
      }

      const validKillers = killers.map(k => k.name.toLowerCase());
      if (!validKillers.includes(normalizedLower)) {
        alert("Invalid killer name. Please choose from the list.");
        return;
      }

      previousGuesses.add(normalizedLower);

      const guessRow = document.createElement("div");
      guessRow.classList.add("guess-row");
      guessRow.textContent = killers.find(k => k.name.toLowerCase() === normalizedLower)?.name || userGuess;

      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        playingTier = null;
      }
      resetAudioButtons();

      if (normalizedLower === currentKiller.name.toLowerCase()) {
        guessRow.classList.add("correct");
        winMessage.textContent = "You won!";
        gameWon = true;
        unlockedTier = 3;
        resetAudioButtons();
        newRoundButton.style.display = 'inline-block';
        document.getElementById("giveUpButton").style.display = 'none';
      } else {
        guessRow.classList.add("wrong");
        if (unlockedTier < 3) unlockedTier++;
        resetAudioButtons();
      }

      guessesContainer.appendChild(guessRow);
      guessInput.value = '';
    });

    newRoundButton.addEventListener("click", () => {
      startNewGame();
    });

    document.getElementById("giveUpButton").addEventListener("click", () => {
      if (!currentKiller || gameWon) return;

      const giveUpRow = document.createElement("div");
      giveUpRow.classList.add("guess-row", "correct");
      giveUpRow.textContent = `${currentKiller.name}`;
      guessesContainer.appendChild(giveUpRow);

      loseMessage.textContent = "You lost!";
      gameWon = true;
      unlockedTier = 3;
      resetAudioButtons();
      newRoundButton.style.display = 'inline-block';
      document.getElementById("giveUpButton").style.display = 'none';
    });

    guessInput.addEventListener("input", () => {
      highlightedIndex = -1;

      const input = guessInput.value.toLowerCase().trim();

      const aliasMatches = Object.keys(aliases)
        .filter(alias => alias.startsWith(input))
        .map(alias => aliases[alias]);

      const nameMatches = killers
        .map(k => k.name)
        .filter(name => name.toLowerCase().startsWith(input));

      const allMatches = [...new Set([...nameMatches, ...aliasMatches])];

      suggestions.innerHTML = '';
      if (input === '' || allMatches.length === 0) {
        suggestions.style.display = 'none';
        return;
      }

      allMatches.forEach(match => {
        const div = document.createElement("div");
        div.textContent = match;
        div.addEventListener("click", () => {
          guessInput.value = match;
          suggestions.style.display = 'none';
        });
        suggestions.appendChild(div);
      });

      suggestions.style.display = 'block';
    });

    let highlightedIndex = -1;

    guessInput.addEventListener("keydown", (e) => {
      const items = suggestions.querySelectorAll("div");

      if (e.key === "ArrowDown") {
        e.preventDefault();
        if (items.length === 0) return;

        highlightedIndex = (highlightedIndex + 1) % items.length;
        updateDropdownHighlight(items);
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        if (items.length === 0) return;

        highlightedIndex = (highlightedIndex - 1 + items.length) % items.length;
        updateDropdownHighlight(items);
      } else if (e.key === "Enter") {
        if (highlightedIndex >= 0 && items.length > 0) {
          e.preventDefault();
          guessInput.value = items[highlightedIndex].textContent;
          suggestions.style.display = 'none';
          highlightedIndex = -1;
        } else {
          document.getElementById("submitGuess").click();
        }
      }
    });

    function updateDropdownHighlight(items) {
      items.forEach((item, i) => {
        item.classList.toggle("highlighted", i === highlightedIndex);
      });

      if (highlightedIndex >= 0 && items.length > 0) {
        items[highlightedIndex].scrollIntoView({
          block: "nearest",
          behavior: "smooth"
        });
      }
    }

    startNewGame();
  </script>
</body>

</html>
